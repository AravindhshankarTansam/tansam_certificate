<div class="leads-container">

  <!-- HEADER -->
  <div class="header">
    <h2>Users List</h2>
    <button class="add-btn" (click)="openModal()">
      <i class="fa-solid fa-plus"></i> Add User
    </button>
  </div>

  <!-- USERS TABLE -->
  <div class="table-wrapper">
    <table class="lead-table">
      <thead>
        <tr>
          <th>#</th>
          <th>Name</th>
          <th>Email</th>
          <th>Mobile</th>
          <th>Role</th>
          <th>Lab</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let u of users; let i = index">
          <td>{{ i + 1 }}</td>
          <td>{{ u.name }}</td>
          <td>{{ u.email }}</td>
          <td>{{ u.mobile }}</td>
          <td>{{ u.role_name }}</td>
          <td>{{ u.lab_name || '-' }}</td>
          <td>
            <span [class.active]="u.is_active" [class.inactive]="!u.is_active">
              {{ u.is_active ? 'Active' : 'Inactive' }}
            </span>
          </td>
          <td>
            <button class="edit-btn" (click)="openModal(u)">
              <i class="fa-solid fa-pen"></i>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- MODAL -->
<div class="modal-backdrop" *ngIf="showModal">
  <div class="modal">
    <h3>{{ editing ? 'Edit User' : 'Add User' }}</h3>

    <!-- USER INPUTS -->
    <input [(ngModel)]="form.name" placeholder="Name" required>
    <input [(ngModel)]="form.email" placeholder="Email" type="email" required>
    <input [(ngModel)]="form.mobile" placeholder="Mobile" type="tel" required>

    <!-- PASSWORD -->
    <div class="password-wrapper">
      <input
        [type]="showPassword ? 'text' : 'password'"
        [(ngModel)]="form.password"
        placeholder="Password"
        [required]="!editing">
      <i class="fa-solid"
         [class.fa-eye]="!showPassword"
         [class.fa-eye-slash]="showPassword"
         (click)="showPassword = !showPassword"></i>
    </div>

<!-- ROLE -->
<div class="field">
  <label>Role</label>
  <select [(ngModel)]="form.role_id" (change)="onRoleChange()" required>
    <option [ngValue]="null" disabled>Select Role</option>
    <option *ngFor="let r of roles" [ngValue]="r.id">
      {{ r.name }}
    </option>
  </select>
</div>

<!-- LAB (ONLY FOR TEAM LEAD) -->
<div *ngIf="isTeamLead" class="field">
  <label>Select Lab</label>
  <select [(ngModel)]="form.lab_id" required>
    <option [ngValue]="null" disabled>Select Lab</option>
    <option *ngFor="let l of labs" [ngValue]="l.id">
      {{ l.name }}
    </option>
  </select>
</div>


    <!-- STATUS TOGGLE -->
    <div class="toggle-row">
      <label class="switch">
        <input type="checkbox" [(ngModel)]="form.is_active">
        <span class="slider"></span>
      </label>
      <span class="status-text">{{ form.is_active ? 'Active' : 'In-active' }}</span>
    </div>

    <!-- ACTION BUTTONS -->
    <div class="actions-btn">
      <button class="cancel" (click)="close()">Cancel</button>
      <button class="save" (click)="save()">Save</button>
    </div>

  </div>
</div>
