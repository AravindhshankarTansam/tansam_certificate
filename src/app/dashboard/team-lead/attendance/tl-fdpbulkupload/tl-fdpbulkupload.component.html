<div class="attendance-container">

  <h2 class="title">FDP Bulk Attendance</h2>

  <div class="card">

    <table class="faculty-table">
      <thead>
        <tr>
          <th>#</th>
          <th>Institution</th>
          <th>From Date</th>
          <th>To Date</th>
          <th>Faculty Count</th>
          <th>Action</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let b of batches; let i = index">
          <td>{{ i + 1 }}</td>
          <td class="name">{{ b.college_name }}</td>
          <td>{{ b.from_date | date }}</td>
          <td>{{ b.to_date | date }}</td>
          <td>{{ b.total_students }}</td>

          <td>
            <button class="btn-primary" (click)="openStaff(b)">
              Take Attendance
            </button>
          </td>
        </tr>
      </tbody>
    </table>

  </div>
</div>


<!-- ================= STAFF LIST ================= -->
<div class="overlay" *ngIf="showStaffModal">

  <div class="modal large">

    <div class="modal-header">
      <h3>{{ selectedBatch?.college_name }}</h3>
      <button class="close-btn" (click)="closeStaff()">âœ•</button>
    </div>

    <div class="card">

      <table class="faculty-table">

        <thead>
          <tr>
            <th>#</th>
            <th>Faculty Name</th>
            <th>Staff ID</th>
            <th>Attendance</th>
            <th>Eligibility</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let s of staff; let i = index">

            <td>{{ i + 1 }}</td>
            <td class="name">{{ s.staff_name }}</td>
            <td>{{ s.staff_id }}</td>

            <td>
              <button class="btn-primary" (click)="openCalendar(s)">
                Open Calendar
              </button>
            </td>

            <td>
              <span
                class="badge"
                [ngClass]="{
                  'eligible': s.attendance_percentage >= 90,
                  'noteligible': s.attendance_percentage < 90
                }">
                {{ s.attendance_percentage || 0 }} %
              </span>
            </td>

          </tr>
        </tbody>

      </table>

    </div>

  </div>

</div>


<!-- ================= CALENDAR ================= -->
<div class="overlay" *ngIf="showCalendar">

  <div class="modal">

    <div class="modal-header">
      <h3>{{ selectedStaff?.staff_name }}</h3>
      <button class="close-btn" (click)="closeCalendar()">âœ•</button>
    </div>

    <div class="legend">
      <span class="box present"></span> Present
      <span class="box holiday"></span> Holiday
      <span class="box normal"></span> Working
    </div>

    <div class="calendar">

      <div
        *ngFor="let d of calendarDays"
        class="day"
        [class.present]="isPresent(d)"
        [class.holiday]="isHoliday(d)"
        (click)="toggleDate(d)">

        {{ d.split('-')[2] }}

        <span *ngIf="isHoliday(d)">ðŸŽ‰</span>

      </div>

    </div>

  </div>

</div>
