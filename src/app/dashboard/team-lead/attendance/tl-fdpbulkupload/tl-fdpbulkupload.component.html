<div class="tl-sdp-page">

  <div class="tl-header">
    <h2>FDP Bulk Upload Records</h2>
  </div>

  <div class="tl-table-card" *ngIf="batches.length; else emptyState">

    <table class="tl-table">
      <thead>
        <tr>
          <th>#</th>
          <th>Institution</th>
          <th>From</th>
          <th>To</th>
          <th>Total Faculty</th>
          <th>View</th>
          <th>Download All</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let batch of batches; let i = index">

          <td>{{ i + 1 }}</td>
          <td>{{ batch.institution_name }}</td>
          <td>{{ batch.from_date | date:'dd-MM-yyyy' }}</td>
          <td>{{ batch.to_date | date:'dd-MM-yyyy' }}</td>
          <td>{{ batch.participants.length }}</td>

          <td>
            <button class="btn-view"
                    (click)="openFaculties(batch)">
              <mat-icon>visibility</mat-icon> View
            </button>
          </td>

          <td>
            <button class="btn-download"
                    (click)="downloadBatch(batch)">
              <mat-icon>download</mat-icon> Download All
            </button>
          </td>

        </tr>
      </tbody>
    </table>

  </div>

  <ng-template #emptyState>
    <div class="tl-empty">
      <h3>No FDP Bulk Uploads Yet</h3>
      <p>Uploaded records will appear here.</p>
    </div>
  </ng-template>

</div>


<!-- FACULTY MODAL -->

<div class="tl-modal-backdrop" *ngIf="showFacultyModal">

  <div class="tl-modal large">

    <div class="tl-modal-header">
      <h3>
        {{ selectedBatch?.institution_name }}
        ({{ selectedBatch?.participants.length }} Faculty)
      </h3>
      <button (click)="closeFaculties()">✕</button>
    </div>

    <div class="tl-modal-body">

      <table class="tl-student-table">

        <thead>
          <tr>
            <th>#</th>
            <th>Name</th>
            <th>Department</th>
            <th>Attendance</th>
            <th>Download</th>
            <th>View</th>
          </tr>
        </thead>

        <tbody>

          <tr *ngFor="let f of selectedBatch?.participants; let i = index">

            <td>{{ i + 1 }}</td>
            <td>{{ f.staff_name }}</td>
            <td>{{ f.department }}</td>

            <td>
              <button class="btn-primary"
                      (click)="openCalendar(f)">
                <mat-icon>event</mat-icon> Attendance
              </button>
            </td>

            <td>
              <button class="btn-download"
                      (click)="downloadFaculty(f)">
                <mat-icon>download</mat-icon> Download
              </button>
            </td>

            <td>
              <button class="btn-view"
                      (click)="downloadFaculty(f)">
                <mat-icon>visibility</mat-icon> View
              </button>
            </td>

          </tr>

        </tbody>

      </table>

    </div>

  </div>

</div>


<!-- ATTENDANCE MODAL -->

<div class="tl-modal-backdrop" *ngIf="showCalendar">

  <div class="tl-modal">

    <div class="tl-modal-header">
      <h3>{{ selectedStudent?.staff_name }}</h3>
      <button (click)="closeCalendar()">✕</button>
    </div>

    <div class="calendar-grid">

      <div
        *ngFor="let d of calendarDays"
        class="day"
        [class.present]="isPresent(d)"
        (click)="toggleDate(d)">

        {{ d.split('-')[2] }}

      </div>

    </div>

    <div class="calendar-summary">
      Present:
      {{ selectedStudent?.present_dates?.length || 0 }}
      /
      {{ calendarDays.length }}
    </div>

  </div>

</div>
