<div class="tl-sdp-page">

  <!-- ================= HEADER ================= -->
  <div class="tl-header">
    <h2>SDP Bulk Upload Records</h2>
  </div>

  <!-- ================= BATCH TABLE ================= -->
  <div class="tl-table-card" *ngIf="batches.length; else emptyState">

    <table class="tl-table">
      <thead>
        <tr>
          <th>#</th>
          <th>College</th>
          <th>From</th>
          <th>To</th>
          <th>Total Students</th>
          <th>View</th>
          <th>Download All</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let batch of batches; let i = index">

          <td>{{ i + 1 }}</td>
          <td>{{ batch.college_name }}</td>
          <td>{{ batch.from_date | date:'dd-MM-yyyy' }}</td>
          <td>{{ batch.to_date | date:'dd-MM-yyyy' }}</td>
          <td>{{ batch.students.length }}</td>

          <!-- VIEW STUDENTS -->
          <td>
            <button class="tl-btn-view"
                    (click)="openStudents(batch)">
              <mat-icon>visibility</mat-icon> View
            </button>
          </td>

          <!-- DOWNLOAD FULL BATCH -->
          <td>
            <button class="tl-btn-download"
                    (click)="downloadBatch(batch)">
              <mat-icon>download</mat-icon> Download All
            </button>
          </td>

        </tr>
      </tbody>
    </table>

  </div>

  <!-- ================= EMPTY STATE ================= -->
  <ng-template #emptyState>
    <div class="tl-empty">
      <h3>No SDP Bulk Uploads Yet</h3>
      <p>Uploaded records will appear here.</p>
    </div>
  </ng-template>

</div>

<!-- ================= STUDENT MODAL ================= -->

<div class="tl-modal-backdrop" *ngIf="showStudentsModal">

  <div class="tl-modal large">

    <div class="tl-modal-header">
      <h3>
        {{ selectedBatch?.college_name }}
        ({{ selectedBatch?.students.length }} Students)
      </h3>
      <button (click)="closeStudents()">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <div class="tl-modal-body">

      <table class="tl-student-table">

        <thead>
          <tr>
            <th>#</th>
            <th>Name</th>
            <th>Register No</th>
            <th>Department</th>
            <th>Attendance</th>
            <th>Download</th>
          </tr>
        </thead>

        <tbody>

          <tr *ngFor="let s of selectedBatch?.students; let i = index">

            <td>{{ i + 1 }}</td>
            <td>{{ s.student_name }}</td>
            <td>{{ s.register_no }}</td>
            <td>{{ s.department }}</td>

            <!-- OPEN ATTENDANCE CALENDAR -->
            <td>
              <button class="tl-btn-view"
                      (click)="openCalendar(s)">
                <mat-icon>event</mat-icon> Attendance
              </button>
            </td>

            <!-- DOWNLOAD INDIVIDUAL CERTIFICATE -->
            <td>
              <button class="tl-btn-single"
                      (click)="downloadStudent(s)">
                <mat-icon>picture_as_pdf</mat-icon> Download
              </button>
            </td>

          </tr>

        </tbody>

      </table>

    </div>

  </div>

</div>

<!-- ================= ATTENDANCE MODAL ================= -->

<div class="tl-modal-backdrop" *ngIf="showCalendar">

  <div class="tl-modal">

    <div class="tl-modal-header">
      <h3>{{ selectedStudent?.student_name }}</h3>
      <button (click)="closeCalendar()">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <div class="calendar-grid">

      <div
        *ngFor="let d of calendarDays"
        class="day"
        [class.present]="isPresent(d)"
        (click)="toggleDate(d)">
        {{ d.split('-')[2] }}
      </div>

    </div>

    <div class="calendar-summary">
      Present:
      {{ selectedStudent?.present_dates?.length || 0 }}
      /
      {{ calendarDays.length }}
    </div>

  </div>

</div>