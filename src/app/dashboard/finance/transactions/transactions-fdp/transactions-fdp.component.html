<div class="sdp-transactions-container">

  <h2>FDP Staff Transactions</h2>

  <!-- Toast -->
  <div class="toast" *ngIf="toastMessage" [ngClass]="toastType">
    <span class="toast-icon">
      <i *ngIf="toastType === 'success'" class="fa-solid fa-circle-check"></i>
      <i *ngIf="toastType === 'info'" class="fa-solid fa-circle-info"></i>
      <i *ngIf="toastType === 'error'" class="fa-solid fa-circle-xmark"></i>
    </span>
    {{ toastMessage }}
  </div>

  <div class="table-responsive">
    <table class="transactions-table">
      <thead>
        <tr>
          <th>Name</th>
          <th>College</th>
          <th>Mode</th>
          <th>Amount</th>
          <th>Txn / Ref No</th>
          <th>Date</th>
          <th *ngIf="isFinance" class="action-col">Action</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let r of rows" [class.editing]="r.isEdit">

          <!-- Name -->
          <td>{{ r.staff_name }}</td>

          <!-- College -->
          <td>{{ r.college_name }}</td>

          <!-- Mode -->
          <td class="mode-cell">
            <ng-container *ngIf="!r.isEdit">
              <span class="badge" [ngClass]="getModeClass(r.payment_mode)">
                {{ r.payment_mode || '—' }}
              </span>
            </ng-container>

            <ng-container *ngIf="r.isEdit">
              <select [(ngModel)]="r.payment_mode" class="form-select">
                <option value="" disabled>Select mode</option>
                <option value="RTGS">RTGS</option>
                <option value="NEFT">NEFT</option>
                <option value="CHEQUE">Cheque</option>
                <option value="UPI">UPI</option>
              </select>
            </ng-container>
          </td>

          <!-- Amount -->
          <td>
            <ng-container *ngIf="!r.isEdit">
              {{ r.amount | number:'1.2-2' }}
            </ng-container>

            <input
              *ngIf="r.isEdit"
              type="number"
              [(ngModel)]="r.amount"
              class="form-input"
              min="1"
              step="0.01"
            />
          </td>

          <!-- Transaction ID -->
          <td>
            <ng-container *ngIf="!r.isEdit">
              {{ r.transaction_id || '—' }}
            </ng-container>

            <input
              *ngIf="r.isEdit"
              [(ngModel)]="r.transaction_id"
              class="form-input"
              [placeholder]="r.payment_mode === 'CHEQUE' ? 'Cheque No' : 'Reference No'"
            />
          </td>

          <!-- Date -->
          <td>
            <ng-container *ngIf="!r.isEdit">
              {{ r.payment_date | date:'dd-MM-yyyy' }}
            </ng-container>

            <input
              *ngIf="r.isEdit"
              type="date"
              [(ngModel)]="r.payment_date"
              class="form-input"
            />
          </td>

          <!-- Actions -->
          <td *ngIf="isFinance" class="action-col">

            <ng-container *ngIf="!r.isEdit">
              <button class="btn btn-edit" (click)="edit(r)">
                <i class="fa-solid fa-pen"></i> Edit
              </button>
            </ng-container>

            <ng-container *ngIf="r.isEdit">
              <button class="btn btn-save" (click)="save(r)">
                <i class="fa-solid fa-check"></i> Save
              </button>

              <button class="btn btn-cancel" (click)="cancel(r)">
                <i class="fa-solid fa-xmark"></i> Cancel
              </button>
            </ng-container>

          </td>

        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="!rows.length" class="empty-state">
    No transactions found
  </div>

</div>
