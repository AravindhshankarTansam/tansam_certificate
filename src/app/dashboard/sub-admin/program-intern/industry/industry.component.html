<div class="industry-container">

  <div class="header">
    <h2>Industry Registration</h2>
    <button class="add-btn" (click)="openModal()">+ Add Staff</button>
  </div>

  <!-- Toast Notification -->
<div class="toast" *ngIf="toastMessage" [ngClass]="toastType">
  <span class="toast-icon">
    <i *ngIf="toastType === 'success'" class="fa-solid fa-circle-check"></i>
    <i *ngIf="toastType === 'info'" class="fa-solid fa-circle-info"></i>
    <i *ngIf="toastType === 'error'" class="fa-solid fa-circle-xmark"></i>
  </span>
  {{ toastMessage }}
</div>

  <div class="table-wrapper" *ngIf="list.length; else empty">
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>Name</th>
          <th>ID</th>
          <th>Industry</th>
          <th>Designation</th>
          <th>Phone</th>
          <th>Email</th>
          <th>Lab</th>
          <th>From</th>
          <th>To</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let row of list; let i = index">
          <td>{{ i + 1 }}</td>
          <td>{{ row.industry_staff_name }}</td>
          <td>{{ row.industry_staff_id }}</td>
          <td>{{ row.industry_name }}</td>
          <td>{{ row.designation_name }}</td>
          <td>{{ row.phone }}</td>
          <td>{{ row.email }}</td>
          <td>{{ row.lab_name }}</td>
          <td>{{ row.from_date | date }}</td>
          <td>{{ row.to_date | date }}</td>
          <td>
            <button class="edit-btn" (click)="openModal(row)">Edit</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <ng-template #empty>
    <div class="empty">No Industry records found</div>
  </ng-template>

  <!-- Modal -->
  <div class="modal-backdrop" *ngIf="showModal">
    <div class="modal">
      <h3>{{ editingId ? 'Edit Industry Staff' : 'Add Industry Staff' }}</h3>

      <form (ngSubmit)="save()" #staffForm="ngForm" novalidate>

        <div class="grid">

          <div class="form-group">
            <label>Industry Staff Name <span class="required">*</span></label>
            <input [(ngModel)]="form.industry_staff_name" name="name" required #nameCtrl="ngModel">
            <div class="error" *ngIf="nameCtrl.invalid && (nameCtrl.dirty || nameCtrl.touched)">
              Name is required
            </div>
          </div>

          <div class="form-group">
            <label>Industry Staff ID</label>
            <input [(ngModel)]="form.industry_staff_id" name="id">
          </div>

          <div class="form-group">
            <label>Industry/Company Name <span class="required">*</span></label>
            <input [(ngModel)]="form.industry_name" name="industry" required #industryCtrl="ngModel">
            <div class="error" *ngIf="industryCtrl.invalid && (industryCtrl.dirty || industryCtrl.touched)">
              Industry name is required
            </div>
          </div>

        <div class="form-group">
          <label>Designation <span class="required">*</span></label>
          <input [(ngModel)]="form.designation_name" name="designation" required #designationCtrl="ngModel">
          <div class="error" *ngIf="designationCtrl.invalid && (designationCtrl.dirty || designationCtrl.touched)">
            Designation is required
          </div>
        </div>

          <div class="form-group">
            <label>Phone <span class="required">*</span></label>
            <input [(ngModel)]="form.phone" name="phone" required pattern="^[0-9]{10}$" #phoneCtrl="ngModel">
            <div class="error" *ngIf="phoneCtrl.invalid && (phoneCtrl.dirty || phoneCtrl.touched)">
              <span *ngIf="phoneCtrl.errors?.['required']">Phone is required</span>
              <span *ngIf="phoneCtrl.errors?.['pattern']">Must be exactly 10 digits</span>
            </div>
          </div>

        <div class="form-group">
          <label>Email <span class="required">*</span></label>
          <input [(ngModel)]="form.email" name="email" type="email" required #emailCtrl="ngModel">
          <div class="error" *ngIf="emailCtrl.invalid && (emailCtrl.dirty || emailCtrl.touched)">
            <span *ngIf="emailCtrl.errors?.['required']">Email is required</span>
            <span *ngIf="emailCtrl.errors?.['email']">Please enter a valid email</span>
          </div>
        </div>

          <div class="form-group">
            <label>Lab <span class="required">*</span></label>
            <select [(ngModel)]="form.lab_id" name="lab" required #labCtrl="ngModel">
              <option value="">Select Lab</option>
              <option *ngFor="let lab of labs" [value]="lab.id">{{ lab.name }}</option>
            </select>
            <div class="error" *ngIf="labCtrl.invalid && (labCtrl.dirty || labCtrl.touched)">
              Please select a lab
            </div>
          </div>

          <div class="form-group">
            <label>From Date</label>
            <input type="date" [(ngModel)]="form.from_date" name="from">
          </div>

          <div class="form-group">
            <label>To Date</label>
            <input type="date" [(ngModel)]="form.to_date" name="to">
          </div>

        </div>

        <div class="error global-error" *ngIf="showValidationError">
          Please fill all required fields
        </div>

        <div class="modal-actions">
          <button type="button" class="cancel-btn" (click)="closeModal()">Cancel</button>
          <button type="submit" class="save-btn" [disabled]="staffForm.invalid">
            {{ editingId ? 'Update' : 'Save' }}
          </button>
        </div>

      </form>
    </div>
  </div>

</div>