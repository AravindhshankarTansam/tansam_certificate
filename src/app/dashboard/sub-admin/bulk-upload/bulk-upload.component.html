<div class="bulk-container">

  <h2>Bulk IV Certificate Upload</h2>

  <!-- ================= FORM ================= -->

  <div class="college-input">

    <input
      type="text"
      placeholder="Enter College Name"
      [(ngModel)]="collegeName"
    />

    <input
      type="text"
      placeholder="College Short Name (ex: PSG)"
      [(ngModel)]="collegeShortName"
    />

    <input
      type="date"
      [(ngModel)]="visitDate"
    />

    <button class="primary" (click)="openPopup()">
      Upload Excel
    </button>

    <button (click)="downloadTemplate()">
      Download Template
    </button>

  </div>
</div>

<!-- ================= VISITS LIST ================= -->

<div class="list-section" *ngIf="visits.length">

  <h3>Uploaded IV Visits</h3>

  <table class="visit-table">

    <thead>
      <tr>
        <th>#</th>
        <th>College</th>
        <th>Short Name</th>
        <th>Date</th>
        <th>Total Students</th>
        <th>View</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let v of visits; let i = index">
        <td>{{ i + 1 }}</td>
        <td>{{ v.college_name }}</td>
        <td>{{ v.college_short_name }}</td>
        <td>{{ v.visit_date }}</td>
        <td>{{ v.total_count }}</td>
        <td>
          <button class="icon-btn view-btn" (click)="openStudents(v)" title="View Students">
            <i class="fa-solid fa-eye"></i>
          </button>
        </td>

      </tr>
    </tbody>

  </table>

</div>
<!-- ================= STUDENTS MODAL ================= -->

<div class="students-backdrop" *ngIf="showStudentsModal">
  <div class="students-modal">
    <div class="header">
      <h2>College Name – {{ selectedVisit?.college_name }}</h2>
      <button class="close-btn" (click)="closeStudents()">✕</button>
    </div>

    <p>Total Students: {{ students.length }}</p>

    <div class="table-wrapper">

      <table>

        <thead>
          <tr>
            <th>#</th>
            <th>Name</th>
            <th>Register No</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Department</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let s of students; let i = index">
            <td>{{ i + 1 }}</td>
            <td>{{ s.name }}</td>
            <td>{{ s.register_number }}</td>
            <td>{{ s.email_id }}</td>
            <td>{{ s.phone_number }}</td>
            <td>{{ s.department }}</td>
          </tr>
        </tbody>

      </table>

    </div>

  </div>
</div>



<!-- ================= UPLOAD POPUP ================= -->

<div class="modal-backdrop" *ngIf="showUploadPopup">

  <div class="modal small">

    <h3>Upload CSV / Excel</h3>

    <input
      type="file"
      accept=".csv,.xlsx,.xls"
      (change)="onFileSelected($event)"
    />

    <p *ngIf="fileName">{{ fileName }}</p>

    <div class="actions">
      <button (click)="closePopup()">Cancel</button>
      <button [disabled]="!selectedFile" (click)="uploadFile()">
        Upload
      </button>
    </div>

  </div>
</div>


<!-- ================= PREVIEW MODAL ================= -->

<div class="modal-backdrop" *ngIf="showPreviewModal">

  <div class="modal fullscreen">

    <div class="header">
      <h2>{{ category }} – Preview</h2>
      <button class="close-btn" (click)="closePreview()">✕</button>
    </div>

    <p>Total Records: {{ uploadedData.length }}</p>

    <div class="table-wrapper">

      <table>

        <thead>
          <tr>
            <th *ngFor="let h of tableHeaders">
              {{ h }}
            </th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let row of uploadedData">

            <td *ngFor="let h of tableHeaders">
              {{ row[h] }}
            </td>

          </tr>
        </tbody>

      </table>

    </div>

    <div class="footer">
      <button (click)="closePreview()">Close</button>
      <button class="primary" (click)="confirmUpload()">
        Confirm Upload
      </button>
    </div>

  </div>
</div>
